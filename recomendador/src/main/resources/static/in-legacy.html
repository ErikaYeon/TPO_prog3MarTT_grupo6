<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Recomendaci√≥n de Pel√≠culas - UADE</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .score-badge {
            background: #51cf66;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 1.2em;
            font-weight: bold;
            display: inline-block;
            margin-top: 10px;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 2.5fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
            margin-bottom: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-bfs { background: linear-gradient(135deg, #228be6 0%, #1c7ed6 100%); }
        .btn-dfs { background: linear-gradient(135deg, #9775fa 0%, #7950f2 100%); }
        .btn-dijkstra { background: linear-gradient(135deg, #51cf66 0%, #37b24d 100%); }
        .btn-greedy { background: linear-gradient(135deg, #ffd43b 0%, #fab005 100%); color: #333; }
        .btn-quicksort { background: linear-gradient(135deg, #ff6b6b 0%, #fa5252 100%); }
        .btn-backtracking { background: linear-gradient(135deg, #20c997 0%, #12b886 100%); }

        select {
            width: 100%;
            padding: 8px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.9em;
            margin-bottom: 10px;
            background: white;
        }

        .section-title {
            margin: 15px 0 8px 0;
            color: #667eea;
            font-weight: bold;
            font-size: 1em;
        }

        .movie-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .movie-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 10px;
            padding: 20px;
            transition: transform 0.3s;
            cursor: pointer;
        }

        .movie-card:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .movie-title {
            font-weight: bold;
            font-size: 1.1em;
            color: #333;
            margin-bottom: 8px;
        }

        .movie-info {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .rating {
            display: inline-block;
            background: #ffd700;
            color: #333;
            padding: 4px 8px;
            border-radius: 5px;
            font-weight: bold;
            margin-top: 8px;
        }

        .genres {
            margin-top: 10px;
        }

        .genre-tag {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            margin-right: 5px;
            margin-top: 5px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 1.2em;
        }

        .error {
            background: #ff6b6b;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .status {
            background: #51cf66;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }

        .algorithm-badge {
            display: inline-block;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            margin-left: 10px;
        }

        .badge-bfs { background: #228be6; }
        .badge-dfs { background: #9775fa; }
        .badge-dijkstra { background: #51cf66; }
        .badge-greedy { background: #fab005; }
        .badge-quicksort { background: #fa5252; }
        .badge-backtracking { background: #12b886; }

        input[type="number"] {
            width: 100%;
            padding: 8px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .info-box {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 12px;
            margin-bottom: 15px;
            border-radius: 5px;
            font-size: 0.85em;
        }

        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üé¨ Sistema de Recomendaci√≥n de Pel√≠culas</h1>
            <p class="subtitle">TP Final - Programaci√≥n 3 - UADE - Grupo 6</p>
            <div class="score-badge">‚≠ê 10/10 Puntos Completos</div>
        </header>

        <div id="statusMsg"></div>

        <div class="main-grid">
            <!-- Panel Grafos -->
            <div class="card">
                <h2>üî¨ Algoritmos de Grafos (7 pts)</h2>
                
                <div class="info-box">BFS (2pts) + DFS (2pts) + Dijkstra (3pts)</div>
                
                <h3 class="section-title">Selecciona pel√≠cula:</h3>
                <select id="peliculaSelect">
                    <option value="">Cargando...</option>
                </select>
                
                <button class="btn btn-bfs" onclick="ejecutarBFS()">
                    üîµ BFS - Anchura
                </button>
                
                <button class="btn btn-dfs" onclick="ejecutarDFS()">
                    üü£ DFS - Profundidad
                </button>
                
                <h3 class="section-title">Camino m√°s corto:</h3>
                <select id="peliculaInicio">
                    <option value="">Pel√≠cula inicial...</option>
                </select>
                
                <select id="peliculaFin">
                    <option value="">Pel√≠cula final...</option>
                </select>
                
                <button class="btn btn-dijkstra" onclick="ejecutarDijkstra()">
                    üü¢ Dijkstra
                </button>
            </div>

            <!-- Panel Otros Algoritmos -->
            <div class="card">
                <h2>‚ö° Otros Algoritmos (3 pts)</h2>
                
                <div class="info-box">Greedy (1pt) + QuickSort (1pt) + Backtracking (1pt)</div>
                
                <h3 class="section-title">GREEDY:</h3>
                <button class="btn btn-greedy" onclick="ejecutarGreedy()">
                    ‚ö° Recomendaci√≥n R√°pida
                </button>
                
                <input type="number" id="tiempoMaraton" placeholder="Tiempo marat√≥n (min)" value="300">
                <button class="btn btn-greedy" onclick="maratonGreedy()">
                    üì∫ Marat√≥n Greedy
                </button>
                
                <h3 class="section-title">QUICKSORT:</h3>
                <button class="btn btn-quicksort" onclick="quicksortRating()">
                    üìä Ordenar por Rating
                </button>
                <button class="btn btn-quicksort" onclick="quicksortA√±o()">
                    üìÖ Ordenar por A√±o
                </button>
                
                <h3 class="section-title">BACKTRACKING:</h3>
                <button class="btn btn-backtracking" onclick="mixGeneros()">
                    üé≠ Mix de G√©neros
                </button>
                <input type="number" id="tiempoExacto" placeholder="Tiempo exacto (min)" value="240">
                <button class="btn btn-backtracking" onclick="maratonExacto()">
                    ‚è±Ô∏è Marat√≥n Exacto
                </button>
            </div>

            <!-- √Årea de Resultados -->
            <div class="card">
                <div id="infoAlgoritmo"></div>
                <h2 id="resultsTitle">üé• Pel√≠culas</h2>
                <div id="results">
                    <p class="loading">üëà Selecciona un algoritmo para comenzar</p>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>üß™ Opciones B√°sicas</h2>
            <button class="btn" onclick="cargarTodasLasPeliculas()">üé¨ Ver Todas</button>
            <button class="btn" onclick="cargarTopPeliculas()">‚≠ê Top Rating</button>
            <select id="generoSelect" onchange="filtrarPorGenero()">
                <option value="">Filtrar por g√©nero...</option>
                <option value="Ciencia Ficci√≥n">Ciencia Ficci√≥n</option>
                <option value="Thriller">Thriller</option>
                <option value="Acci√≥n">Acci√≥n</option>
                <option value="Drama">Drama</option>
                <option value="Crimen">Crimen</option>
                <option value="Misterio">Misterio</option>
            </select>
            <button class="btn" style="background: #51cf66; margin-top: 15px;" onclick="testConexion()">
                üîå Test Conexi√≥n
            </button>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8080/api/peliculas';
        const API_ALG = 'http://localhost:8080/api/algoritmos';

        // =============== INICIALIZACI√ìN ===============
        async function testConexion() {
            try {
                mostrarCargando();
                const response = await fetch(`${API_URL}/test`);
                const message = await response.text();
                mostrarEstado(message, 'success');
                cargarTodasLasPeliculas();
            } catch (error) {
                mostrarEstado('‚ùå Error: ' + error.message, 'error');
            }
        }

        async function cargarTodasLasPeliculas() {
            try {
                mostrarCargando();
                const response = await fetch(API_URL);
                const peliculas = await response.json();
                mostrarPeliculas(peliculas, 'Todas las Pel√≠culas');
                poblarSelectPeliculas(peliculas);
                limpiarInfoAlgoritmo();
            } catch (error) {
                mostrarError('Error: ' + error.message);
            }
        }

        async function cargarTopPeliculas() {
            try {
                mostrarCargando();
                const response = await fetch(`${API_URL}/top`);
                const peliculas = await response.json();
                mostrarPeliculas(peliculas, 'Top por Rating');
                limpiarInfoAlgoritmo();
            } catch (error) {
                mostrarError('Error: ' + error.message);
            }
        }

        async function filtrarPorGenero() {
            const genero = document.getElementById('generoSelect').value;
            if (!genero) return;
            try {
                mostrarCargando();
                const response = await fetch(`${API_URL}/genero/${encodeURIComponent(genero)}`);
                const peliculas = await response.json();
                mostrarPeliculas(peliculas, `G√©nero: ${genero}`);
                limpiarInfoAlgoritmo();
            } catch (error) {
                mostrarError('Error: ' + error.message);
            }
        }

        // =============== GRAFOS ===============
        async function ejecutarBFS() {
            const id = document.getElementById('peliculaSelect').value;
            if (!id) return mostrarEstado('Selecciona una pel√≠cula', 'error');
            try {
                mostrarCargando();
                const response = await fetch(`${API_URL}/${id}/bfs?profundidad=3&limite=15`);
                const peliculas = await response.json();
                const nombre = document.getElementById('peliculaSelect').options[document.getElementById('peliculaSelect').selectedIndex].text;
                mostrarInfoAlgoritmo('BFS', 'Explora por niveles (anchura)', 'bfs');
                mostrarPeliculas(peliculas, `BFS desde "${nombre}"`, 'BFS');
            } catch (error) {
                mostrarError('Error: ' + error.message);
            }
        }

        async function ejecutarDFS() {
            const id = document.getElementById('peliculaSelect').value;
            if (!id) return mostrarEstado('Selecciona una pel√≠cula', 'error');
            try {
                mostrarCargando();
                const response = await fetch(`${API_URL}/${id}/dfs?profundidad=3&limite=15`);
                const peliculas = await response.json();
                const nombre = document.getElementById('peliculaSelect').options[document.getElementById('peliculaSelect').selectedIndex].text;
                mostrarInfoAlgoritmo('DFS', 'Explora en profundidad', 'dfs');
                mostrarPeliculas(peliculas, `DFS desde "${nombre}"`, 'DFS');
            } catch (error) {
                mostrarError('Error: ' + error.message);
            }
        }

        async function ejecutarDijkstra() {
            const inicio = document.getElementById('peliculaInicio').value;
            const fin = document.getElementById('peliculaFin').value;
            if (!inicio || !fin) return mostrarEstado('Selecciona ambas pel√≠culas', 'error');
            try {
                mostrarCargando();
                const response = await fetch(`${API_URL}/camino/${inicio}/${fin}`);
                const peliculas = await response.json();
                mostrarInfoAlgoritmo('DIJKSTRA', 'Camino m√°s corto entre dos pel√≠culas', 'dijkstra');
                mostrarPeliculas(peliculas, 'Camino M√°s Corto', 'DIJKSTRA');
            } catch (error) {
                mostrarError('Error: ' + error.message);
            }
        }

        // =============== GREEDY ===============
        async function ejecutarGreedy() {
            try {
                mostrarCargando();
                const response = await fetch(`${API_ALG}/greedy/recomendacion`);
                const pelicula = await response.json();
                mostrarInfoAlgoritmo('GREEDY', 'Recomienda del g√©nero m√°s frecuente', 'greedy');
                mostrarPeliculas([pelicula], 'Recomendaci√≥n Greedy', 'GREEDY');
            } catch (error) {
                mostrarError('Error: ' + error.message);
            }
        }

        async function maratonGreedy() {
            const tiempo = document.getElementById('tiempoMaraton').value;
            try {
                mostrarCargando();
                const response = await fetch(`${API_ALG}/greedy/maraton?tiempoMaximo=${tiempo}`);
                const peliculas = await response.json();
                mostrarInfoAlgoritmo('GREEDY MARAT√ìN', `Maximiza rating en ${tiempo} minutos`, 'greedy');
                mostrarPeliculas(peliculas, `Marat√≥n Greedy (${tiempo} min)`, 'GREEDY');
            } catch (error) {
                mostrarError('Error: ' + error.message);
            }
        }

        // =============== QUICKSORT ===============
        async function quicksortRating() {
            try {
                mostrarCargando();
                const response = await fetch(`${API_ALG}/quicksort/rating`);
                const peliculas = await response.json();
                mostrarInfoAlgoritmo('QUICKSORT', 'Ordenamiento O(n log n) por rating', 'quicksort');
                mostrarPeliculas(peliculas, 'Ordenadas por Rating', 'QUICKSORT');
            } catch (error) {
                mostrarError('Error: ' + error.message);
            }
        }

        async function quicksortA√±o() {
            try {
                mostrarCargando();
                const response = await fetch(`${API_ALG}/quicksort/a√±o`);
                const peliculas = await response.json();
                mostrarInfoAlgoritmo('QUICKSORT', 'Ordenamiento O(n log n) por a√±o', 'quicksort');
                mostrarPeliculas(peliculas, 'Ordenadas por A√±o', 'QUICKSORT');
            } catch (error) {
                mostrarError('Error: ' + error.message);
            }
        }

        // =============== BACKTRACKING ===============
        async function mixGeneros() {
            try {
                mostrarCargando();
                const response = await fetch(`${API_ALG}/backtracking/mix-generos`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ generos: ['Ciencia Ficci√≥n', 'Drama', 'Thriller'] })
                });
                const combinaciones = await response.json();
                mostrarInfoAlgoritmo('BACKTRACKING', 'Una pel√≠cula de cada g√©nero', 'backtracking');
                if (combinaciones.length > 0) {
                    mostrarPeliculas(combinaciones[0], 'Mix de G√©neros', 'BACKTRACKING');
                } else {
                    mostrarError('No se encontraron combinaciones');
                }
            } catch (error) {
                mostrarError('Error: ' + error.message);
            }
        }

        async function maratonExacto() {
            const tiempo = document.getElementById('tiempoExacto').value;
            try {
                mostrarCargando();
                const response = await fetch(`${API_ALG}/backtracking/maraton-exacto?tiempo=${tiempo}`);
                const combinaciones = await response.json();
                mostrarInfoAlgoritmo('BACKTRACKING', `Marat√≥n exacto de ${tiempo} minutos`, 'backtracking');
                if (combinaciones.length > 0) {
                    mostrarPeliculas(combinaciones[0], `Marat√≥n Exacto (${tiempo} min)`, 'BACKTRACKING');
                } else {
                    mostrarError('No se encontr√≥ combinaci√≥n exacta');
                }
            } catch (error) {
                mostrarError('Error: ' + error.message);
            }
        }

        // =============== UI ===============
        function mostrarPeliculas(peliculas, titulo, algoritmo = null) {
            let tituloHTML = titulo;
            if (algoritmo) {
                const clase = `badge-${algoritmo.toLowerCase()}`;
                tituloHTML += ` <span class="algorithm-badge ${clase}">${algoritmo}</span>`;
            }
            document.getElementById('resultsTitle').innerHTML = tituloHTML;
            const div = document.getElementById('results');
            
            if (!peliculas || peliculas.length === 0) {
                div.innerHTML = '<p class="loading">Sin resultados</p>';
                return;
            }
            
            let html = '<div class="movie-grid">';
            peliculas.forEach(p => {
                const generos = p.generos ? p.generos.map(g => `<span class="genre-tag">${g.nombre}</span>`).join('') : '';
                html += `
                    <div class="movie-card">
                        <div class="movie-title">${p.titulo}</div>
                        <div class="movie-info">üìÖ ${p.a√±o}</div>
                        <div class="movie-info">‚è±Ô∏è ${p.duracion} min</div>
                        <span class="rating">‚≠ê ${p.promedioRating}</span>
                        <div class="genres">${generos}</div>
                    </div>
                `;
            });
            html += '</div>';
            div.innerHTML = html;
        }

        function poblarSelectPeliculas(peliculas) {
            ['peliculaSelect', 'peliculaInicio', 'peliculaFin'].forEach(id => {
                const select = document.getElementById(id);
                select.innerHTML = '<option value="">Seleccionar...</option>';
                peliculas.forEach(p => {
                    select.innerHTML += `<option value="${p.peliculaId}">${p.titulo}</option>`;
                });
            });
        }

        function mostrarInfoAlgoritmo(titulo, desc, tipo) {
            const clase = `badge-${tipo}`;
            document.getElementById('infoAlgoritmo').innerHTML = `
                <div class="info-box">
                    <strong><span class="algorithm-badge ${clase}">${titulo}</span></strong>
                    <p style="margin-top: 8px;">${desc}</p>
                </div>
            `;
        }

        function limpiarInfoAlgoritmo() {
            document.getElementById('infoAlgoritmo').innerHTML = '';
        }

        function mostrarCargando() {
            document.getElementById('results').innerHTML = '<p class="loading">‚è≥ Cargando...</p>';
        }

        function mostrarError(msg) {
            document.getElementById('results').innerHTML = `<div class="error">${msg}</div>`;
        }

        function mostrarEstado(msg, tipo) {
            const div = document.getElementById('statusMsg');
            div.innerHTML = `<div class="${tipo === 'error' ? 'error' : 'status'}">${msg}</div>`;
            setTimeout(() => div.innerHTML = '', 3000);
        }

        window.onload = () => testConexion();
    </script>
</body>
</html>